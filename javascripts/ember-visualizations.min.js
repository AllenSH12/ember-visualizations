// ==========================================================================
// Project:   Ember Visualizations
// Copyright: 2012 Christopher Meiklejohn and Basho Technologies, Inc.
// License:   Licensed under the Apache 2.0 license (see LICENSE).
// ==========================================================================


(function(){Ember.CanvasView=Ember.View.extend({xMargin:70,yMargin:20,containerWidth:980,containerHeight:300,aspectRatio:980/300,viewBox:function(){var a=this.get("containerWidth"),b=this.get("containerHeight");return"0 0 "+a+" "+b}.property("containerWidth").cacheable(),preserveAspectRatio:function(){return"xMinYMid"}.property("containerWidth").cacheable(),width:function(){return this.get("containerWidth")}.property("containerWidth").cacheable(),height:function(){return this.get("containerWidth")/this.get("aspectRatio")}.property("containerWidth").cacheable(),didInsertElement:function(){var a=this,b=this.$();Ember.run.next(function(){a.set("containerWidth",b.width()),$(window).resize(function(){a.set("containerWidth",b.width())})}),this._super()}})})(),function(){Ember.VisualizationView=Ember.View.extend({tagName:"svg",attributeBindings:["width","height","preserveAspectRatio","viewBox"],xMargin:0,yMargin:0,xScale:function(){return d3.scale.linear()}.property("content").cacheable(),yScale:function(){return d3.scale.linear()}.property("content").cacheable(),xFormatter:function(a){return a},yFormatter:function(a){return a},redraw:function(){this.rerender()}.observes("content"),didInsertElement:function(){var a=this,b=this.$().attr("id"),c=this.get("xScale"),d=this.get("yScale"),e=this.get("xMargin"),f=this.get("yMargin"),g=this.get("width"),h=this.get("height"),i=this.get("xFormatter"),j=this.get("yFormatter"),k,l,m;m=d3.select("#"+b),k=d3.svg.axis().scale(c).orient("bottom").tickFormat(i),l=d3.svg.axis().scale(d).orient("left").tickFormat(j),m.append("g").attr("class","x axis").attr("transform","translate(0,"+(h-f)+")").call(k),m.append("g").attr("class","y axis").attr("transform","translate("+e+", 0)").call(l),m.insert("g",":first-child").attr("class","x grid").attr("transform","translate(0,"+(h-f)+")").call(k.tickSize(-h+f*2,0,0).tickFormat("")),m.insert("g",":first-child").attr("class","y grid").attr("transform","translate("+e+", 0)").call(l.tickSize(-g+e*2,0,0).tickFormat(""))}})}(),function(){Ember.HistogramView=Ember.VisualizationView.extend({histogram:function(){var a=this.get("content"),b=a[0];return b.x&&b.y?a:d3.layout.histogram()(this.getPath("content"))}.property("content").cacheable(),xScale:function(){var a=this.get("histogram"),b=this.get("width"),c=this.get("xMargin");return d3.scale.ordinal().domain(a.map(function(a){return a.x})).rangeRoundBands([0+c,b-c])}.property("histogram").cacheable(),yScale:function(){var a=this.get("histogram"),b=this.get("height"),c=this.get("yMargin");return d3.scale.linear().domain([0,d3.max(a.map(function(a){return a.y}))]).range([b-c,0+c])}.property("histogram").cacheable(),didInsertElement:function(){var a=this,b=this.get("histogram"),c=this.$().attr("id"),d=this.get("xScale"),e=this.get("yScale"),f=this.get("xMargin"),g=this.get("yMargin"),h=this.get("width"),i=this.get("height"),j=this.get("xFormatter"),k=this.get("yFormatter"),l,m,n;n=d3.select("#"+c),n.selectAll("rect").data(b).enter().append("rect").attr("class","sample").attr("width",d.rangeBand()).attr("x",function(a){return d(a.x)}).attr("y",function(a){return e(a.y)}).attr("height",function(a){return i-g-e(a.y)}),this._super()}})}(),function(){Ember.TimeSeriesView=Ember.VisualizationView.extend({path:function(){var a=this.get("content"),b=this.get("xScale"),c=this.get("yScale");return d3.svg.line().interpolate("linear").x(function(a){return b(a.x)}).y(function(a,b){return c(a.y)})(a)}.property("content").cacheable(),xScale:function(){var a=this.get("content"),b=this.get("width"),c=this.get("xMargin"),d=a[0],e=a[a.length-1];if(d&&e)return d3.time.scale().domain([d.x,e.x]).range([0+c,b-c])}.property("content").cacheable(),yScale:function(){var a=this.get("content"),b=this.get("height"),c=this.get("yMax"),d=this.get("yMargin");return d3.scale.linear().domain([0,c]).range([b-d,0+d])}.property("content").cacheable(),yMax:function(){var a=this.get("content");return d3.max(a.map(function(a){return parseFloat(a.y)}))}.property("samples").cacheable(),didInsertElement:function(){var a=this,b=this.get("path"),c=this.$().attr("id"),d=this.get("xScale"),e=this.get("yScale"),f=this.get("xMargin"),g=this.get("yMargin"),h=this.get("width"),i=this.get("height"),j=this.get("xFormatter"),k=this.get("yFormatter"),l,m,n;n=d3.select("#"+c),n.append("g").append("path").attr("class","series").attr("d",b),this._super()}})}(),function(){}()